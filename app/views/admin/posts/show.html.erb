<h2 class="m-3">スポット詳細</h2>

<div class="row justify-content-center">
  <div class="col-sm-5">
    <%= image_tag @place.get_image, size:"400x400", class:"text-center m-3" %>
  </div>

  <div class="col-sm-5">
    <h3><%= @place.title %></h3>
    <p><%= @place.body %></p>
    <div class="text-right">
      <%= link_to "削除", admin_post_path(@place.id), method: :delete, "data-confirm" => "この投稿を削除します。よろしいですか？", class:"btn btn-outline-danger" %>
    </div>
  </div>
</div>

<div class="row justify-content-center">
  <div class="col-sm-5">
    <div id='map'></div>

    <style>
      #map{
        height: 500px;
        width: 400px;
      }
    </style>

    <script>
      let map;
      function initMap(){
        geocoder = new google.maps.Geocoder()

        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: <%= @place.latitude %>, lng: <%= @place.longitude %>},
          zoom: 12
        });

        marker = new google.maps.Marker({
          position: {lat: <%= @place.latitude %>, lng: <%= @place.longitude %>},
          map: map
        });
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API'] %>&callback=initMap" async defer></script>
  </div>

  <div class="col-sm-5">
    <h4>スポット情報</h4>
    <table class="table table-borderless">
      <tr>
        <tr>
          <th>住所</th>
          <td><%= @place.address %></td>
        </tr>
        <th>営業時間</th>
        <td><%= @place.business_hour %></td>
      </tr>
      <tr>
        <th>料金</th>
        <td><%= @place.price %></td>
      </tr>
      <tr>
        <th>アクセス方法</th>
        <td><%= @place.access %></td>
      </tr>
      <tr>
        <th>投稿者</th>
        <td>
          <%= @user.last_name %> <%= @user.first_name %>
          <%= @user.nickname %>
        </td>
      </tr>
      <tr>
        <th>タグ</th>
        <td>
          <% @post_tags.each do |tag| %>
            <%= link_to tag.name, post_search_tag_path(@place, tag) %>
            <%= "(#{tag.posts.count})" %>
          <% end %>
        </td>
      </tr>
    </table>
  </div>
</div>

<div class="row">
  <div class="col-sm-10 offset-sm-1">
    <p>コメント件数：<%= @place.comments.count %></p>
    <% @place.comments.each do |comment| %>
      <%= comment.user.last_name %>
      <%= comment.user.first_name %>
      <%= comment.user.nickname %>
      <%= comment.created_at.strftime('%Y/%m/%d') %><%= comment.comment %>
      <%= link_to "削除", post_comment_path(comment.post, comment), method: :delete, class:"btn btn-outline-warning" %>
    <% end %>
  </div>

</div>
